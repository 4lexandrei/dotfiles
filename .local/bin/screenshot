#!/bin/bash

# ┌────────────┐
# │ screenshot │
# └────────────┘

save_dir="$HOME/Pictures/Screenshots"
timestamp=$(date +%F_%H-%M-%S)
new_save="$save_dir/screenshot-$timestamp.png"

# Create Screenshot dir if it doesn't exist
if [[ ! -d "$save_dir" ]]; then
  echo "Creating $save_dir as screenshots directory"
  mkdir -p "$save_dir"
fi

if [[ "$1" == "cut" || "$1" == "-c" ]]; then
  # Capture region with slurp
  region=$(slurp)

  if [[ -z "$region" ]]; then
    echo "Region selection canceled. Exiting..."
    exit 0
  fi

  grim -g "$region" "$new_save"
else

  # Full-screen screenshot
  for i in {4..1}; do
    echo -ne "\rTaking fullscreen screenshot in $i seconds..."
    sleep 1
  done
  echo ""

  grim "$new_save"
fi

# Check if the screenshot was created
if [[ ! -f "$new_save" ]]; then
  echo "[ERROR] Screenshot was not saved. Exiting..."
  exit 1
fi

# Prompt for new filename after taking the screenshot
echo -ne "Rename screenshot or press 'Enter' to keep default: "
read -r screenshot_name

if [[ -n "$screenshot_name" ]]; then
  save_as="$save_dir/$screenshot_name.png"
  mv "$new_save" "$save_as"
  echo "Screenshot saved as $save_as"
else
  echo "Screenshot saved as $new_save"
fi
